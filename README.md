# Автотесты

Т.к. проект у моего разработчика вообще не готов, либо он просто меня игнорит, то я писала все тесты вслепую. И не уверена по поводу реализации в целом. В качестве своего стека выбрала python и pytest.

### Автотесты на API сервиса 

Для CRM системы тесты находятся в [папке crm](https://github.com/MarinaVasilevaIVT/nexign_avtotests/tree/main/crm):
Разберем состав папки поподробнее:

1. ```python utils``` - пакет, в котором находятся вспомогательный файл для получения токенов авторизации менеджеров (auth.py) и вспомогательный файл для работы с переменными окружения для хранения конфиденциальной информации (config.py).

2. ```python conftest.py``` - файл, в котором хранятся фикстуры
3. ```python test_auth.py``` - в данном файле находятся тесты на успешную авторизацию менеджера и абонента (позитивные тесты), а также тест с неверным паролем у менеджера (негативный) и тест на попытку авторизации абонента без ввода номера телефона (негативный). 
4. ```python test_recharge.py``` - в данном файле находятся тест на успешное пополение баланса абонента менежером (позитивный) , на пополнение баланса с невалидной суммой и пополение баланса без авторизации менеджера (негативные)
5. ```python test_subscriber.py``` - в данном файле находятся тесты на успешное получение информации об абоненте менеджером(позитивный), на успешное создание менеджером нового абонента (позитивный). Из негативных тестов тут представлены: попытка менеджером получение информации об абоненте неавторизовавшись, попытка получения информации о несуществующем абоненте и попытка менеджером создать нового абонента неавторизовавшись 
6. ```python test_tariff``` - в данном файле находятся тесты, в которых менеджер меняет тариф абоненту: на существующий - позитивный тест, на несуществующий - негативный. Также представлен негативный тест на попытку смену тарифа неавторизованным менеджером.

Для данных тестов будет усместна вырезка из документации аналитика:

Спецификация API для менеджера и абонента.
Методы:
•	pay – пополнение баланса;
•	changeTariff – смена тарифа;
•	save – создание нового абонента оператора «Ромашка». Имена атрибутов:
•	msisdn – Mobile Subscriber Integrated Services Digital Number – номер мобильного абонента цифровой сети;
•	money – деньги (cумма для пополнения баланса абонента);
•	tariffId – идентификационный номер тарифа.

Описание методов для endpoint’ов:

| Описание | Метод	| Путь | 
| ------------- | ------------- | ------------- |
| Изменение тарифа абонента оператора "Ромашка"	| PATCH	| /changeTariff/{msisdn}| 
| Пополнение баланса абонента оператора "Ромашка"	| PATCH	| /pay/{msisdn}|
| Добавление нового абонента "Ромашка"	| POST	| /save| 

### Автотесты на валидацию CDR и генерация CDR-файлов

Для CDR тесты находятся в [папке cdr](https://github.com/MarinaVasilevaIVT/nexign_avtotests/tree/main/cdr):

В ней представлены файлы:
* ```python avto_generate_cdr.py``` - для написания кода я использовала библиотеку random. Соответственно написала функции для генерации номера телефона, даты и времени, не нашла в документации, но предположила, что звонок не может быть дольше 24 часов (и то будто звучит диковато). Также написала функцию, которая делит звонок на два при пересечении полуночи. Ну и две функции, которые генерируют валидный и невалидный CDR-файл. 
* ```python test_cdr_upload.py``` - по сути получается так, что в позитивном тесте отправляется валидная CDR-ка и приходит ответ 200, а в случае негативных тестов, я добавила параметризацию, т.к. я генерирую 9 видов разных невалидных файлов, и ответ должен прийти 4хх.
И несколько примеров сгенерированных cdr-файлов.

### Автотесты на e2e процесс
Для тесты находятся в [папке e2e](https://github.com/MarinaVasilevaIVT/nexign_avtotests/tree/main/e2e):
Разберем состав папки поподробнее:
#### Классический тариф
Принцип: Стоимость списывается сразу после звонка.

**Тест 1:** Исходящий звонок (менее минуты) внутри сети.
**Ожидаем:** Списание фиксированной суммы (например, 1.5 у.е. за звонок).

**Тест 2:** Исходящий звонок (б минут 22 сек) к другому оператору.
**Ожидаем:** Списание пропорционально времени (например, 7 мин * 2,5 = 17,5 у.е.).

#### Помесячный тариф
Принцип: Списание происходит раз в 30 дней, учитываются включенные минуты.

**Тест 1:** Звонки в пределах лимита (например, 50 минут).
**Ожидаем:** Списание только месячной платы.

**Тест 2:** Звонки сверх лимита (100 минут).
**Ожидаем:** Месячная плата + оплата за 50 минут сверх.

По моему мнению, эти тесты получились у меня максимально сырыми, потому что сложно без продукта понять особенности реализации. 

